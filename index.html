<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name='admaven-placement' content=Bqjw7rjnF>
    <title>Quiz Islam - Vrai/Faux avancÃ©</title>
    <style>
       @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap');
        
        *{margin:0;padding:0;box-sizing:border-box}
        
        #ramadanCountdown {
            position: absolute; top: 15px; left: 20px;
            background: rgba(255, 215, 0, 0.2); border: 2px solid #FFD700;
            border-radius: 12px; padding: 10px 16px; color: #FFD700;
            font-size: 1.3rem; font-weight: bold; text-align: center;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3); z-index: 10; min-width: 220px;
        }

        body{
            font-family:'Amiri',serif;
            background:linear-gradient(135deg,#143C30,#1D483C); 
            color:#e2e8f0; min-height:100vh; display:flex;
            align-items:center; justify-content:center; padding:15px; position:relative
        }

        .box{
            width:100%; max-width:500px; background:rgba(20,60,48,0.96); 
            border-radius:28px; padding:40px 30px; box-shadow:0 25px 70px rgba(0,0,0,0.8);
            border:2px solid #6B8E23; text-align:center
        }

        h1{ font-size:3.4rem; color:#FFD700; text-shadow:0 0 30px #DAA520; margin-bottom:20px }

        .menu-btn{
            display:block; width:88%; margin:20px auto; padding:22px;
            font-size:1.75rem; font-weight:700; color:#143C30;
            background:linear-gradient(135deg,#FFD700,#B8860B); 
            border:none; border-radius:60px; cursor:pointer;
            box-shadow:0 12px 35px rgba(255,215,0,0.5); transition:all .4s
        }

        .menu-btn:hover{ transform:translateY(-8px) }

        .hidden{ display:none }

        input{
            width:85%; padding:16px; margin:12px 0; border:none;
            border-radius:50px; font-size:1.3rem; text-align:center;
            background:#1E293B; color:#fff
        }

        .user-info{ background:#6B8E23; padding:15px; border-radius:20px; margin:20px 0; font-size:1.2rem }
        .xp-bar{ height:18px; background:#1e293b; border-radius:10px; overflow:hidden; margin:15px 0 }
        .xp-fill{ height:100%; background:linear-gradient(90deg,#DAA520,#FFD700); width:0; transition:width 1s ease }

        .leaderboard-table{ width:100%; border-collapse:collapse; margin:20px 0; }
        .leaderboard-table th { background:#6B8E23; color:#fff; padding:12px; }
        .leaderboard-table td { padding:12px; border-bottom:1px solid #1e293b; }

        .question { font-size:1.65rem; padding:30px; background:rgba(30,41,59,0.9); border-radius:22px; margin:20px 0; }
        .ans-container { display:flex; justify-content:center; gap:15px; }
        .ans { flex:1; padding:20px; border-radius:15px; cursor:pointer; font-weight:bold; font-size:1.5rem; color:white; }
        .vrai { background:#388E3C; }
        .faux { background:#D32F2F; }
    </style>
</head>
<body>

<div class="box">
    <div id="auth">
        <h1>Quiz Islam</h1>
        <p style="margin-bottom:20px;">Connectez-vous pour sauvegarder votre XP</p>
        <input type="text" id="pseudo" placeholder="Pseudo">
        <input type="password" id="password" placeholder="Mot de passe">
        <button class="menu-btn" onclick="login()">Se connecter</button>
        <button class="menu-btn" style="background:#4f4f4f; color:white;" onclick="register()">CrÃ©er un compte</button>
    </div>

    <div id="menu" class="hidden">
        <h1>Menu</h1>
        <div id="ramadanCountdown">Ramadan 2026 : <span id="countdownTimer">...</span></div>
        <div class="user-info">
            Bienvenue <strong id="usernameDisplay"></strong><br>
            ðŸ’° Points : <strong id="userPoints">0</strong> | Niveau : <strong id="levelNum">1</strong>
        </div>
        <div class="xp-bar"><div class="xp-fill" id="xpFill"></div></div>
        
        <button class="menu-btn" onclick="startQuiz()">Jouer</button>
        <button class="menu-btn" onclick="showLeaderboard()">Classement</button>
        <button class="menu-btn" style="background:#8b0000; color:white;" onclick="logout()">DÃ©connexion</button>
    </div>

    <div id="game" class="hidden">
        <div id="questionContainer" class="question">Chargement...</div>
        <div class="ans-container">
            <div class="ans vrai" onclick="checkAnswer(true)">VRAI</div>
            <div class="ans faux" onclick="checkAnswer(false)">FAUX</div>
        </div>
        <button class="menu-btn" style="margin-top:20px;" onclick="showScreen('menu')">Quitter</button>
    </div>

    <div id="leaderboard" class="hidden">
        <h1>Classement</h1>
        <table class="leaderboard-table" id="leaderboardTable">
            <thead><tr><th>#</th><th>Joueur</th><th>XP</th></tr></thead>
            <tbody></tbody>
        </table>
        <button class="menu-btn" onclick="showScreen('menu')">Retour</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
    import { getDatabase, ref, set, get, update, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCMJ7E_pQuy2b2T82DrXqSZH_e1zJcAjzs",
        authDomain: "islamic-quiz-620fb.firebaseapp.com",
        projectId: "islamic-quiz-620fb",
        storageBucket: "islamic-quiz-620fb.firebasestorage.app",
        messagingSenderId: "1076586266222",
        appId: "1:1076586266222:web:109cfd4a53f4c04587307f"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Variables de session
    let currentUser = null;
    let userData = {};
    let currentQIndex = 0;

    const questions = [
        {q: "La sourate la plus courte est Al-Kawthar.", a: true},
        {q: "Le ProphÃ¨te Muhammad ï·º a eu 4 filles.", a: true},
        {q: "Le Ramadan dure 40 jours.", a: false},
        {q: "La premiÃ¨re rÃ©vÃ©lation fut dans la grotte de Hira.", a: true}
    ];

    // FONCTIONS GLOBALES (Window)
    window.login = async function() {
        const p = document.getElementById('pseudo').value.trim();
        const pass = document.getElementById('password').value;
        if(!p || !pass) return alert("Remplissez les champs !");

        const snapshot = await get(ref(db, 'users/' + p));
        if(snapshot.exists() && snapshot.val().password === pass) {
            currentUser = p;
            userData = snapshot.val();
            showMenu();
        } else { alert("Pseudo ou mot de passe incorrect !"); }
    };

    window.register = async function() {
        const p = document.getElementById('pseudo').value.trim();
        const pass = document.getElementById('password').value;
        if(!p || !pass) return alert("Remplissez les champs !");

        const snapshot = await get(ref(db, 'users/' + p));
        if(snapshot.exists()) return alert("Ce pseudo existe dÃ©jÃ  !");

        userData = { pseudo: p, password: pass, xp: 0, points: 0, level: 1 };
        await set(ref(db, 'users/' + p), userData);
        currentUser = p;
        showMenu();
    };

    window.showScreen = function(id) {
        document.querySelectorAll('.box > div').forEach(d => d.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    };

    function showMenu() {
        window.showScreen('menu');
        document.getElementById('usernameDisplay').innerText = currentUser;
        updateUI();
        initRamadan();
    }

    function updateUI() {
        document.getElementById('userPoints').innerText = userData.points;
        document.getElementById('levelNum').innerText = userData.level;
        document.getElementById('xpFill').style.width = (userData.xp % 100) + "%";
    }

    window.startQuiz = function() {
        currentQIndex = 0;
        window.showScreen('game');
        loadQuestion();
    };

    function loadQuestion() {
        if(currentQIndex >= questions.length) {
            alert("Quiz terminÃ© ! +20 XP");
            userData.xp += 20;
            userData.points += 5;
            userData.level = Math.floor(userData.xp / 100) + 1;
            update(ref(db, 'users/' + currentUser), userData);
            showMenu();
            return;
        }
        document.getElementById('questionContainer').innerText = questions[currentQIndex].q;
    }

    window.checkAnswer = function(choice) {
        if(choice === questions[currentQIndex].a) {
            alert("Correct !");
        } else {
            alert("Faux !");
        }
        currentQIndex++;
        loadQuestion();
    };

    window.showLeaderboard = async function() {
        window.showScreen('leaderboard');
        const snapshot = await get(query(ref(db, 'users'), orderByChild('xp'), limitToLast(10)));
        const tbody = document.querySelector('#leaderboardTable tbody');
        tbody.innerHTML = "";
        let list = [];
        snapshot.forEach(c => { list.push(c.val()); });
        list.reverse().forEach((u, i) => {
            tbody.innerHTML += `<tr><td>${i+1}</td><td>${u.pseudo}</td><td>${u.xp}</td></tr>`;
        });
    };

    window.logout = () => location.reload();

    function initRamadan() {
        const target = new Date("March 1, 2026 00:00:00").getTime();
        setInterval(() => {
            const diff = target - new Date().getTime();
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            document.getElementById('countdownTimer').innerText = days + "j";
        }, 1000);
    }
</script>
</body>
</html>
